# Store Seed Data Importer

소상공인 상가업소 데이터를 XLSX 파일에서 읽어 데이터베이스에 대량 삽입하는 도구입니다.

## 사용 방법

### 1. 데이터 파일 준비

1. 소상공인진흥공단 상가업소 데이터를 XLSX 형식으로 다운로드합니다.
2. 파일을 `data/` 디렉토리에 저장합니다.

```bash
# 예시
cp ~/Downloads/상가업소정보.xlsx data/stores.xlsx
```

### 2. 실행

```bash
# 프로젝트 루트 디렉토리에서 실행
go run cmd/seed/main.go data/stores.xlsx
```

### 3. 확인

실행 시 다음 정보가 출력됩니다:
- 읽은 시트 이름
- 헤더 정보
- 유효한 매장 수
- 스킵된 행 수
- 좌표가 없는 행 수

확인 후 `yes`를 입력하면 실제 import가 시작됩니다.

## XLSX 파일 형식

다음 컬럼들이 필요합니다 (총 38개 컬럼):

| 인덱스 | 컬럼명 | 설명 | 매핑 필드 |
|--------|--------|------|-----------|
| 0 | 상가업소번호 | - | (사용 안함) |
| 1 | 상호명 | 매장 이름 | `name` |
| 2 | 지점명 | 지점명 | `branch_name` |
| 12 | 시도명 | 시/도 | `region` |
| 14 | 시군구명 | 구/군 | `district` |
| 16 | 행정동명 | 행정동 | `dong` |
| 24 | 지번주소 | 지번 주소 | `address` (대체) |
| 29 | 건물명 | 건물명 | `building_name` |
| 30 | 도로명주소 | 도로명 주소 | `address` (우선) |
| 33 | 신우편번호 | 우편번호 | `postal_code` |
| 34 | 층정보 | 층 | `floor` |
| 35 | 호정보 | 호수 | `unit` |
| 36 | 경도 | 경도 좌표 | `longitude` |
| 37 | 위도 | 위도 좌표 | `latitude` |

## 데이터 처리 규칙

### 필수 필드 검증
- `상호명`, `시도명`, `시군구명`이 비어있는 행은 스킵됩니다.

### 주소 처리
- 도로명주소가 있으면 우선 사용
- 도로명주소가 없으면 지번주소 사용

### 좌표 처리
- 경도/위도가 0이거나 파싱 불가능한 경우 NULL로 저장
- 좌표가 없어도 매장은 저장됩니다

### 중복 제거
- 이름 + 시도 + 시군구 + 주소 조합으로 중복 체크
- 중복된 행은 스킵됩니다

### Slug 생성
- `district-name` 형식으로 자동 생성 (예: `강남구-매장명`)
- 중복 시 숫자 suffix 추가 (예: `강남구-매장명-2`)
- BeforeCreate 훅에서 자동 처리

### 기본값
- `user_id`: NULL (비관리 매장)
- `is_managed`: false
- `is_verified`: false

## 성능 최적화

- 배치 크기: 1000건
- 트랜잭션 단위로 커밋
- 진행 상황 1000건마다 출력

## 예상 소요 시간

| 데이터 규모 | 예상 시간 |
|-------------|-----------|
| 1만 건 | ~30초 |
| 10만 건 | ~5분 |
| 100만 건 | ~30분 |

※ 실제 시간은 서버 성능 및 네트워크 상태에 따라 다를 수 있습니다.

## 주의사항

1. **백업**: 운영 DB에 실행하기 전에 반드시 백업하세요.
2. **중복 실행**: 같은 파일을 여러 번 실행하면 중복 데이터가 생성될 수 있습니다.
3. **인덱스**: 대량 데이터 삽입 전에 인덱스를 일시 비활성화하면 성능이 향상됩니다.
4. **타임아웃**: 대용량 파일의 경우 DB 타임아웃 설정 확인이 필요합니다.

## 문제 해결

### "no sheets found in XLSX file"
- XLSX 파일이 손상되었거나 빈 파일입니다.
- 파일을 다시 다운로드하세요.

### "Failed to connect to database"
- `.env` 파일의 DB 설정을 확인하세요.
- PostgreSQL 서버가 실행 중인지 확인하세요.

### "Skipped rows" 수가 많음
- XLSX 파일 형식이 예상과 다를 수 있습니다.
- 헤더 정보를 확인하고 인덱스를 조정하세요.

## 개발자 정보

### 코드 구조

```
cmd/seed/
  main.go           # 메인 실행 파일
  README.md         # 이 문서

internal/app/repository/
  store_repository.go  # BulkCreate 메서드 구현

data/
  .gitkeep          # Git 추적용
  stores.xlsx       # 데이터 파일 (gitignore됨)
```

### 확장 방법

1. **태그 자동 매핑**: `상권업종소분류명`을 태그로 변환
2. **주소 정규화**: 주소 형식 통일
3. **재시도 로직**: 실패한 행 재처리
4. **진행률 표시**: Progress bar 추가
